<?xml version="1.0" encoding="UTF-8"?>
<project name="OnlyCoreAndScripts" default="Compile" basedir=".">

	<property name="build" location="./../test/game"/>
	<property name="src" location="java"/>
	<property name="lib" location="lib"/>

	<path id="classpath">
		<fileset dir="${lib}">
			<include name="c3p0-0.9.1.2.jar"/>
			<include name="javolution.jar"/>
			<include name="commons-logging.jar"/>
			<include name="jce.jar"/>
			<include name="rrd4j-2.0.5.jar"/>
			<include name="mysql-connector-java-bin.jar"/>
			<include name="tools.jar"/>
			<include name="jacksum.jar"/>
			<include name="l2pserver.jar"/>
		</fileset>
	</path>

	<target name="Compile">

		<mkdir dir="${build}/classes"/>

		<javac destdir="${build}/classes"
		       optimize="on"
		       debug="on"
		       source="1.6"
		       target="1.6"
		       encoding="UTF-8"
		       includeantruntime="false"
		       nowarn="off">
			<compilerarg value="-Xlint:all"/>
			<src path="${src}"/>
			<classpath refid="classpath"/>
		</javac>

		<exec executable="svn/svnversion" outputproperty="l2p.revision" failifexecutionfails="false">
			<arg line="-n ."/>
		</exec>

		<tstamp>
			<format property="build.tstamp"
			        pattern="yyyy.MM.dd HH:mm"/>
		</tstamp>

		<concat destfile="${build}/classes/l2p/l2p-version.properties">
			version=${l2p.revision}
			builddate=${build.tstamp}
			user=${user.name}
			os=${os.name} ${os.version} ${os.arch}
			java=${java.version} ${java.vendor}
		</concat>

		<jar destfile="${build}/l2pserver.jar" level="0">
			<fileset dir="${build}/classes"/>
			<manifest>
				<attribute name="Main-Class" value="l2p.Server"/>
				<attribute name="Class-Path"
				           value=". c3p0-0.9.1.2.jar jacksum.jar mysql-connector-java-bin.jar javolution.jar commons-logging.jar tools.jar"/>
			</manifest>
		</jar>

		<copy todir="${lib}">
			<fileset dir="${build}">
				<include name="l2pserver.jar"/>
			</fileset>
		</copy>

		<mkdir dir="${build}/scripts"/>

		<javac destdir="${build}/scripts"
		       optimize="on"
		       debug="on"
		       source="1.6"
		       target="1.6"
		       encoding="UTF-8"
		       nowarn="on">
			<compilerarg value="-Xlint:all"/>
			<src path="dp/data"/>
			<classpath refid="classpath"/>
		</javac>

		<jar destfile="${build}/scripts.jar" level="0">
			<fileset dir="${build}/scripts"/>
		</jar>

		<delete file="${lib}/l2pserver.jar"/>
		<delete dir="${build}/classes"/>
		<delete dir="${build}/scripts"/>
	</target>
</project>